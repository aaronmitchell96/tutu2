<!DOCTYPE html>
<html>
<head>
    <title>Image Gallery</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/styles.css">
    <script>
        // Function to show/hide filters based on category selection
        function handleCategoryChange() {
            var category = document.getElementById("category").value;
            var hatTypeDiv = document.getElementById("hatTypeDiv");
            var accessoryTypeDiv = document.getElementById("accessoryTypeDiv");

            if (category === "hat") {
                hatTypeDiv.style.display = "block";
                accessoryTypeDiv.style.display = "none";
            } else if (category === "accessory") {
                hatTypeDiv.style.display = "none";
                accessoryTypeDiv.style.display = "block";
            } else {
                hatTypeDiv.style.display = "none";
                accessoryTypeDiv.style.display = "none";
            }
        }

        // Run the function on page load to ensure correct display
        window.onload = function() {
            handleCategoryChange();
        };
    </script>
</head>
<body>
    <%- include('navbar') %>
    <h1>Image Gallery</h1>

    <!-- Include Filter Bar -->
    <form action="/gallery" method="GET">
        <div>
            <label for="category">Category:</label>
            <select id="category" name="category" onchange="handleCategoryChange()">
                <option value="">All</option>
                <option value="hat" <%= category === 'hat' ? 'selected' : '' %>>Hat</option>
                <option value="accessory" <%= category === 'accessory' ? 'selected' : '' %>>Accessory</option>
            </select>
        </div>

        <div>
            <label for="gender">Gender:</label>
            <select id="gender" name="gender">
                <option value="">All</option>
                <option value="men" <%= gender === 'men' ? 'selected' : '' %>>Men</option>
                <option value="women" <%= gender === 'women' ? 'selected' : '' %>>Women</option>
            </select>
        </div>

        <div id="hatTypeDiv" style="display:none;">
            <label for="hatType">Hat Type:</label>
            <select id="hatType" name="hatType">
                <option value="">All</option>
                <% hatTypes.forEach(function(type) { %>
                    <option value="<%= type %>" <%= hatType === type ? 'selected' : '' %>><%= type %></option>
                <% }); %>
            </select>
        </div>

        <div id="accessoryTypeDiv" style="display:none;">
            <label for="accessoryType">Accessory Type:</label>
            <select id="accessoryType" name="accessoryType">
                <option value="">All</option>
                <% accessoryTypes.forEach(function(type) { %>
                    <option value="<%= type %>" <%= accessoryType === type ? 'selected' : '' %>><%= type %></option>
                <% }); %>
            </select>
        </div>

        <div>
            <label for="color">Color:</label>
            <input type="text" id="color" name="color" value="<%= color %>">
        </div>

        <div>
            <label for="minPrice">Min Price:</label>
            <input type="number" id="minPrice" name="minPrice" value="<%= minPrice %>">
        </div>

        <div>
            <label for="maxPrice">Max Price:</label>
            <input type="number" id="maxPrice" name="maxPrice" value="<%= maxPrice %>">
        </div>

        <button type="submit">Filter</button>
    </form>

    <div>
        <% images.forEach(function(image) { %>
            <div>
                <a href="/image/<%= image.id %>">
                    <img src="<%= image.path %>" alt="Image" style="width: 200px; height: auto;" />
                </a>
                <% if (image.children && image.children.length > 0) { %>
                    <div class="thumbnail-container">
                        <% image.children.forEach(function(childImage) { %>
                            <a href="/image/<%= childImage.id %>">
                                <img src="<%= childImage.path %>" alt="Image" class="thumbnail" />
                            </a>
                        <% }); %>
                    </div>
                <% } %>
            </div>
        <% }); %>
    </div>
    <a href="/upload">Upload More Images</a>
</body>
</html>
